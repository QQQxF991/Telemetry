# Сервис обработки телеметрии

## Описание
Сервис для приема и обработки бинарных сообщений телеметрии от внешних устройств с предоставлением HTTP API для доступа к данным.
Примечание : система сборки для version 1 не создана до конца , советуется использовать version 2 как рабочий сервис . 

## Архитектура

### 1. Хранение данных
- **Кольцевой буфер**: Для каждого устройства создается кольцевой буфер на 50 значений
- **Структура данных**: `DeviceData` содержит:
  - Массив `buffer[50]` для хранения последних измерений
  - Индекс `head` для указания позиции следующей записи
  - Счетчик `count` для отслеживания количества элементов
  - Структура `latest` для быстрого доступа к последнему значению

### 2. Проверка CRC8
- **Алгоритм**: XOR всех байтов сообщения
- **Реализация**: Функция `calculate_crc8` вычисляет контрольную сумму для первых 13 байт
- **Валидация**: При получении сообщения вычисленный CRC сравнивается с переданным

### 3. Парсинг сообщений
- **Формат**: 14 байт: 1 (device_id) + 4 (float) + 8 (timestamp) + 1 (CRC)
- **Порядок байт**: Big-endian для всех числовых полей
- **Обработка**: Функция `parse_binary_message`:
  1. Проверяет CRC
  2. Извлекает device_id
  3. Конвертирует float из big-endian
  4. Конвертирует timestamp из big-endian
  5. Возвращает false при ошибке CRC

### 4. Потокобезопасность
- **Мьютекс**: `devices_mutex` защищает доступ к общей структуре данных `devices`
- **Атомарный флаг**: `running` для корректного завершения работы

### 5. Серверы
- **Бинарный сервер** (порт 9001):
  - Принимает TCP-соединения
  - Обрабатывает сообщения по 14 байт
  - Каждое соединение обрабатывается в отдельном потоке
- **HTTP сервер** (порт 8080):
  - Предоставляет REST API
  - Обрабатывает GET запросы
  - Возвращает данные в формате JSON

### 6. API эндпоинты
- `GET /device/{id}/latest` - последнее значение устройства
- `GET /device/{id}/stats` - статистика (min, max, average, count)

## Сборка и запуск

### Требования
- C++17 компилятор
- CMake 3.10+
- Linux/Unix система

### Сборка
```bash
mkdir build
cd build
cmake ..
make